services:
  echolingo:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: echolingo
    restart: unless-stopped
    ports:
      - "5173:5173"
      - "8787:8787"
    env_file:
      - .env
    environment:
      API_PORT: 8787
      WEB_PORT: 5173
      VITE_ALLOWED_HOSTS: localhost,127.0.0.1
    volumes:
      - ./docker-data:/app/data

  echolingo-tunnel:
    build:
      context: .
      dockerfile: Dockerfile.cloudflared
    container_name: echolingo-tunnel
    restart: unless-stopped
    depends_on:
      - echolingo
    command: tunnel --config /app/cloudflared-docker.yml run
    volumes:
      - ./cloudflared-docker.yml:/app/cloudflared-docker.yml:ro
      - ${CLOUDFLARED_DIR}:/etc/cloudflared:ro

